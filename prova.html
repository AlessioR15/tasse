<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Editor di testo con indentazione sincronizzata</title>
    <style>
        textarea {
            width: 100%;
            height: 300px;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>

<h2>Editor di testo con indentazione sincronizzata</h2>
<textarea id="textInput"></textarea>

<script>
    const textInput = document.getElementById('textInput');
    let previousText = '';

    textInput.addEventListener('input', function(e) {
        const currentText = textInput.value;

        // Dividi il testo precedente e corrente in linee
        const previousLines = previousText.split('\n');
        const currentLines = currentText.split('\n');

        // Ottieni la posizione del cursore
        const cursorPosition = textInput.selectionStart;

        // Trova l'indice della linea corrente
        const textBeforeCursor = currentText.substring(0, cursorPosition);
        const lineIndex = textBeforeCursor.split('\n').length - 1;

        // Ottieni il contenuto precedente e corrente della linea
        const previousLine = previousLines[lineIndex] || '';
        const currentLine = currentLines[lineIndex] || '';

        // Trova gli spazi iniziali della linea precedente e corrente
        const previousLeadingSpaces = (previousLine.match(/^(\s*)/) || ['',''])[1];
        const currentLeadingSpaces = (currentLine.match(/^(\s*)/) || ['',''])[1];

        // Calcola la differenza negli spazi iniziali
        const diffSpaces = currentLeadingSpaces.length - previousLeadingSpaces.length;

        if (diffSpaces !== 0) {
            // Regola gli spazi iniziali di tutte le altre linee
            for (let i = 0; i < currentLines.length; i++) {
                if (i !== lineIndex) {
                    const line = currentLines[i];
                    const lineLeadingSpaces = (line.match(/^(\s*)/) || ['',''])[1];
                    let newLeadingSpacesLength = lineLeadingSpaces.length + diffSpaces;
                    if (newLeadingSpacesLength < 0) newLeadingSpacesLength = 0;
                    const newLeadingSpaces = ' '.repeat(newLeadingSpacesLength);
                    currentLines[i] = newLeadingSpaces + line.trimStart();
                }
            }

            // Aggiorna il contenuto dell'area di testo
            const newText = currentLines.join('\n');
            const lengthDifference = newText.length - currentText.length;
            textInput.value = newText;

            // Riposiziona il cursore
            const newCursorPosition = cursorPosition + lengthDifference;
            textInput.selectionStart = newCursorPosition;
            textInput.selectionEnd = newCursorPosition;
        }

        // Aggiorna il testo precedente
        previousText = textInput.value;
    });
</script>

</body>
</html>
