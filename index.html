<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Calcolatore Regime Forfettario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* CSS */
        body {
            background-color: #f4f4f4;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
        }
#disclaimer {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border: 1px solid #f5c6cb;
            margin-bottom: 20px;
            font-size: 16px;
            text-align: center;
        }
        .calculator-container {
            background-color: #fff;
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .calculator-container h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .form-group button {
            background-color: #007BFF;
            color: #fff;
            padding: 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 18px;
        }

        .form-group button:hover {
            background-color: #0056b3;
        }

        #risultati {
            margin-top: 30px;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tabs button {
            flex: 1;
            padding: 15px;
            border: none;
            background-color: #ddd;
            cursor: pointer;
            font-size: 16px;
            margin: 2px;
        }

        .tabs button.active {
            background-color: #007BFF;
            color: #fff;
        }

        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }

        .result-content {
            color: #555;
            line-height: 1.6;
            font-size: 16px;
        }

        .result-content h2 {
            color: #333;
            margin-top: 0;
        }

        .result-content h3 {
            color: #007BFF;
            margin-top: 20px;
        }

        .result-content p {
            margin: 10px 0;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .result-table th,
        .result-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            font-size: 16px;
        }

        .result-table th {
            background-color: #f2f2f2;
        }

        /* Stili per evidenziare saldi e acconti */
        .saldo {
            background-color: #d4edda; /* Verde pastello per i saldi */
            font-weight: bold;
        }

        .acconto {
            background-color: #d1ecf1; /* Celeste per gli acconti */
            font-weight: bold;
        }

        .highlight {
            font-weight: bold;
            color: #007BFF;
        }

        @media (max-width: 600px) {
            .tabs button {
                font-size: 14px;
            }

            .result-table th,
            .result-table td {
                font-size: 14px;
            }

            .form-group input,
            .form-group select,
            .form-group button {
                font-size: 14px;
            }

            .result-content {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

     <div id="disclaimer">
            <strong>Questo calcolatore è da usare solo per previsioni a grandi linee e non sostituisce un vero calcolo effettuato da un commercialista.</strong>
        </div>

    <div class="calculator-container">
        <h1>Calcolatore Regime Forfettario</h1>
        <form id="calculator-form">
            <div class="form-group">
                <label for="annoRiferimento">Anno di riferimento:</label>
                <select id="annoRiferimento">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>
            <div class="form-group">
                <label for="redditoIncassato">Reddito incassato con partita IVA (€):</label>
                <input type="number" id="redditoIncassato" required>
            </div>
            <div class="form-group">
                <label for="impostaSostitutiva">Imposta sostitutiva:</label>
                <select id="impostaSostitutiva">
                    <option value="5">5%</option>
                    <option value="15">15%</option>
                </select>
            </div>
            <div class="form-group">
                <label for="coefficienteRedditività">Coefficiente di redditività del tuo codice Ateco:</label>
                <select id="coefficienteRedditività">
                    <option value="86">86%</option>
                    <option value="78">78%</option>
                    <option value="67">67%</option>
                    <option value="40">40%</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cassaPrevidenziale">Seleziona la cassa previdenziale a cui sei iscritto:</label>
                <select id="cassaPrevidenziale">
                    <option value="gestioneSeparata">Gestione Separata INPS</option>
                    <option value="inpsCommercianti">INPS Commercianti</option>
                    <option value="inpsArtigiani">INPS Artigiani</option>
                    <!-- Altre casse previdenziali -->
                </select>
            </div>
            <div class="form-group" id="riduzioneContainer" style="display: none;">
                <label for="riduzione35">Ho richiesto la riduzione del 35%:</label>
                <input type="checkbox" id="riduzione35">
            </div>
            <div class="form-group" id="dataAperturaContainer" style="display: none;">
                <label for="dataApertura">Data di apertura della Partita IVA:</label>
                <input type="date" id="dataApertura">
            </div>
            <div class="form-group">
                <button type="button" onclick="calcola()">Calcola</button>
            </div>
        </form>
        <div id="risultati"></div>
    </div>

    <script>
        // JavaScript
        // Dati per gli anni di riferimento
        const anniRiferimento = {
            "2024": {
                "gestioneSeparata": 26,
                "inpsCommercianti": {
                    "contributoFisso": 4515,
                    "aliquotaVariabile": 24,
                    "sogliaReddito": 18415
                },
                "inpsArtigiani": {
                    "contributoFisso": 4427,
                    "aliquotaVariabile": 24,
                    "sogliaReddito": 18415
                }
            },
            "2025": {
                // Aggiorna le percentuali per il 2025 se necessario
            }
        };

        // Mostra/nasconde campi in base alla cassa previdenziale selezionata
        document.getElementById('cassaPrevidenziale').addEventListener('change', function() {
            const cassa = this.value;
            const riduzioneContainer = document.getElementById('riduzioneContainer');
            const dataAperturaContainer = document.getElementById('dataAperturaContainer');
            if (cassa === 'inpsCommercianti' || cassa === 'inpsArtigiani') {
                riduzioneContainer.style.display = 'block';
                dataAperturaContainer.style.display = 'block';
            } else {
                riduzioneContainer.style.display = 'none';
                dataAperturaContainer.style.display = 'none';
            }
        });

        function calcola() {
            const anno = document.getElementById('annoRiferimento').value;
            const redditoIncassato = parseInt(document.getElementById('redditoIncassato').value);
            const impostaSostitutiva = parseInt(document.getElementById('impostaSostitutiva').value);
            const coefficienteRedditività = parseInt(document.getElementById('coefficienteRedditività').value);
            const cassaPrevidenziale = document.getElementById('cassaPrevidenziale').value;
            const riduzione35 = document.getElementById('riduzione35').checked;
            const dataApertura = document.getElementById('dataApertura').value ? new Date(document.getElementById('dataApertura').value) : null;

            const redditoNetto = Math.round(redditoIncassato * (coefficienteRedditività / 100));
            let contributi = 0;
            let imposta = Math.round((redditoNetto * impostaSostitutiva) / 100);

            let contributiFissi = 0;
            let contributiVariabili = 0;
            let rateContributiFissi = [];
            let totaleContributiFissi = 0;

            if (cassaPrevidenziale === 'gestioneSeparata') {
                const aliquotaContributi = anniRiferimento[anno]["gestioneSeparata"];
                contributi = Math.round((redditoNetto * aliquotaContributi) / 100);
                totaleContributiFissi = 0;
            } else if (cassaPrevidenziale === 'inpsCommercianti' || cassaPrevidenziale === 'inpsArtigiani') {
                const datiCassa = anniRiferimento[anno][cassaPrevidenziale];
                // Calcolo del contributo fisso
                contributiFissi = datiCassa.contributoFisso;
                if (riduzione35) {
                    contributiFissi = Math.round(contributiFissi * 0.65);
                }
                // Calcolo delle rate dei contributi fissi
                if (dataApertura) {
                    const risultato = calcolaContributoFissoProporzionale(contributiFissi, dataApertura, anno);
                    rateContributiFissi = risultato.rate;
                    totaleContributiFissi = risultato.totale;
                } else {
                    const rata = Math.round(contributiFissi / 4);
                    rateContributiFissi = [
                        { data: `16 maggio ${anno}`, importo: rata },
                        { data: `20 agosto ${anno}`, importo: rata },
                        { data: `16 novembre ${anno}`, importo: rata },
                        { data: `16 febbraio ${parseInt(anno) + 1}`, importo: rata }
                    ];
                    totaleContributiFissi = rata * 4;
                }
                // Calcolo del contributo variabile se supera la soglia
                if (redditoNetto > datiCassa.sogliaReddito) {
                    const eccedenza = redditoNetto - datiCassa.sogliaReddito;
                    contributiVariabili = Math.round((eccedenza * datiCassa.aliquotaVariabile) / 100);
                }
                contributi = totaleContributiFissi + contributiVariabili;
            } else {
                // Placeholder per altre casse previdenziali
                contributi = 0;
                totaleContributiFissi = 0;
            }

            // Calcolo di saldi e acconti
            const saldoImposte = imposta;
            const accontoImposte = imposta; // 100% del saldo
            const saldoContributi = contributi;
            let accontoContributi = 0;
            if (cassaPrevidenziale === 'gestioneSeparata') {
                accontoContributi = Math.round(contributi * 0.8); // 80% del saldo
            } else if (cassaPrevidenziale === 'inpsCommercianti' || cassaPrevidenziale === 'inpsArtigiani') {
                accontoContributi = Math.round(contributiVariabili * 0.8); // Solo sui contributi variabili
            }

            mostraRisultati({
                anno,
                redditoIncassato,
                coefficienteRedditività,
                redditoNetto,
                impostaSostitutiva,
                imposta,
                contributiFissi,
                contributiVariabili,
                contributi,
                saldoImposte,
                accontoImposte,
                saldoContributi,
                accontoContributi,
                cassaPrevidenziale,
                rateContributiFissi,
                totaleContributiFissi
            });
        }

        function calcolaContributoFissoProporzionale(contributoFisso, dataApertura, anno) {
            const trimestri = [
                { start: new Date(`${anno}-01-01`), end: new Date(`${anno}-03-31`), rata: 1, scadenza: `16 maggio ${anno}` },
                { start: new Date(`${anno}-04-01`), end: new Date(`${anno}-06-30`), rata: 2, scadenza: `20 agosto ${anno}` },
                { start: new Date(`${anno}-07-01`), end: new Date(`${anno}-09-30`), rata: 3, scadenza: `16 novembre ${anno}` },
                { start: new Date(`${anno}-10-01`), end: new Date(`${anno}-12-31`), rata: 4, scadenza: `16 febbraio ${parseInt(anno) +1}` }
            ];

            let rate = [];
            const contributoTrimestre = Math.round(contributoFisso / 4);
            let totale = 0;

            let trimestreApertura = -1;

            for (let i = 0; i < trimestri.length; i++) {
                const trimestre = trimestri[i];
                if (dataApertura >= trimestre.start && dataApertura <= trimestre.end) {
                    trimestreApertura = i;
                    break;
                }
            }

            if (trimestreApertura === -1) {
                // Se la data di apertura è fuori dai trimestri (non dovrebbe accadere), considera tutti i trimestri
                trimestreApertura = 0;
            }

            for (let i = trimestreApertura; i < 4; i++) {
                const trimestre = trimestri[i];
                if (i === trimestreApertura) {
                    // Calcolo proporzionale della prima rata
                    const daysInQuarter = (trimestre.end - trimestre.start) / (1000 * 60 * 60 * 24) + 1;
                    const daysActive = (trimestre.end - dataApertura) / (1000 * 60 * 60 * 24) + 1;
                    const proporzione = daysActive / daysInQuarter;
                    const importo = Math.round(contributoTrimestre * proporzione);
                    rate.push({ data: trimestre.scadenza, importo });
                    totale += importo;
                } else {
                    // Paga l'intero contributo trimestrale
                    rate.push({ data: trimestre.scadenza, importo: contributoTrimestre });
                    totale += contributoTrimestre;
                }
            }

            return { rate, totale };
        }

        function mostraRisultati(data) {
            const risultatiDiv = document.getElementById('risultati');
            risultatiDiv.innerHTML = `
                <div class="result-overview">
                    <h2>Risultati</h2>
                    ${generaPanoramica(data)}
                </div>
                <div class="tabs">
                    <button class="tablink active" onclick="openTab(event, 'calcoli')">Come si calcolano</button>
                    <button class="tablink" onclick="openTab(event, 'dettagli')">Dettagli pagamenti</button>
                    <button class="tablink" onclick="openTab(event, 'scadenze')">Scadenze pagamenti</button>
                </div>
                <div id="calcoli" class="tab active">
                    ${generaTestoCalcoli(data)}
                </div>
                <div id="dettagli" class="tab">
                    ${generaDettagliPagamenti(data)}
                </div>
                <div id="scadenze" class="tab">
                    ${generaScadenzePagamenti(data)}
                </div>
            `;
        }

        function generaPanoramica(data) {
            let panoramica = `
                <table class="result-table">
                    <tr>
                        <th>Descrizione</th>
                        <th>Importo</th>
                    </tr>
                    <tr>
                        <td>Reddito Lordo:</td>
                        <td class="highlight">${data.redditoIncassato}€</td>
                    </tr>
                    <tr>
                        <td>Reddito Netto (${data.anno}):</td>
                        <td class="highlight">${data.redditoNetto}€</td>
                    </tr>
                    <tr>
                        <td>Imposta Sostitutiva (${data.impostaSostitutiva}%) sul ${data.anno}:</td>
                        <td class="highlight">${data.imposta}€</td>
                    </tr>
                    <tr>
                        <td>Acconto Imposta Sostitutiva (100%) sul ${parseInt(data.anno) + 1}:</td>
                        <td class="highlight">${data.accontoImposte}€</td>
                    </tr>
                    <tr>
                        <td>Contributi INPS sul ${data.anno}:</td>
                        <td class="highlight">${data.saldoContributi}€</td>
                    </tr>
            `;

            if (data.accontoContributi > 0) {
                panoramica += `
                    <tr>
                        <td>Acconto Contributi INPS sul ${parseInt(data.anno) + 1}:</td>
                        <td class="highlight">${data.accontoContributi}€</td>
                    </tr>
                `;
            }

            panoramica += `</table>`;
            return panoramica;
        }

        function generaTestoCalcoli(data) {
            let testo = '';
            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                testo = `
                    <div class="result-content">
                        <h2>Dettaglio dei Calcoli</h2>
                        <p>In regime forfettario paghi l'imposta sostitutiva, che nel tuo caso è del <strong>${data.impostaSostitutiva}%</strong>.</p>
                        <p>L'imposta come i contributi li paghi non sul totale incassato ma sul <strong>${data.coefficienteRedditività}%</strong> (che è il coefficiente di redditività del tuo codice ATECO).</p>
                        <p>Quindi paghi il <strong>${data.impostaSostitutiva}%</strong> di imposta e il <strong>${anniRiferimento[data.anno]["gestioneSeparata"]}%</strong> di contributi INPS non sul totale incassato (<strong>${data.redditoIncassato}€</strong>) ma sul tuo incassato per il coefficiente di redditività.</p>
                        <p>${data.redditoIncassato}€ x ${data.coefficienteRedditività}% = ${data.redditoNetto}€ (reddito netto imponibile)</p>
                        <h3>Nota bene:</h3>
                        <ul>
                            <li>Se nell'anno di riferimento hai versato dei contributi, questi vengono detratti dal tuo reddito netto.</li>
                            <li>Se avevi versato gli acconti nell'anno precedente, questi vengono scalati dai saldi che devi versare quest'anno.</li>
                        </ul>
                        <h3>Esempio di calcolo:</h3>
                        <p>Per un incasso di ${data.redditoIncassato}€, il ${data.coefficienteRedditività}% corrisponde a ${data.redditoNetto}€. Su questo importo, dovrai pagare:</p>
                        <ul>
                            <li>Imposta sostitutiva: ${data.impostaSostitutiva}% su ${data.redditoNetto}€, che equivale a <span class="saldo">${data.imposta}€</span>.</li>
                            <li>Contributi INPS: ${anniRiferimento[data.anno]["gestioneSeparata"]}% su ${data.redditoNetto}€, che equivale a <span class="saldo">${data.contributi}€</span>.</li>
                        </ul>
                        <p>Quindi, a livello di saldo, pagherai ${data.imposta + data.contributi}€ (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi).</p>
                        <h3>Acconti:</h3>
                        <p>Oltre al saldo, dovrai versare anche gli acconti per l’anno successivo:</p>
                        <ul>
                            <li>Imposta sostitutiva: pagherai il 100% dell'importo del saldo come acconto, quindi ulteriori <span class="acconto">${data.accontoImposte}€</span>.</li>
                            <li>Contributi INPS: pagherai l’80% dell'importo del saldo come acconto, quindi <span class="acconto">${data.accontoContributi}€</span>.</li>
                        </ul>
                        <h3>Totale complessivo:</h3>
                        <p>Saldo totale: ${data.imposta + data.contributi}€ (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi)</p>
                        <p>Acconti totali: ${data.accontoImposte + data.accontoContributi}€ (di cui ${data.accontoImposte}€ di imposta e ${data.accontoContributi}€ di contributi)</p>
                        <p><strong>Importo complessivo (saldo + acconti): ${data.imposta + data.contributi + data.accontoImposte + data.accontoContributi}€</strong></p>
                        <p>Questi importi sono indicativi e, in sede di dichiarazione dei redditi, verranno calcolati con precisione.</p>
                    </div>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                testo = `
                    <div class="result-content">
                        <h2>Dettaglio dei Calcoli</h2>
                        <p>In regime forfettario paghi l'imposta sostitutiva, che nel tuo caso è del <strong>${data.impostaSostitutiva}%</strong>.</p>
                        <p>Paghi inoltre i contributi fissi INPS ${data.cassaPrevidenziale === 'inpsCommercianti' ? 'Commercianti' : 'Artigiani'} di <strong>${data.totaleContributiFissi}€</strong> all'anno.</p>
                        <p>L'imposta e i contributi variabili si calcolano sul <strong>${data.coefficienteRedditività}%</strong> del tuo incassato.</p>
                        <p>${data.redditoIncassato}€ x ${data.coefficienteRedditività}% = ${data.redditoNetto}€ (reddito netto imponibile)</p>
                        <h3>Nota bene:</h3>
                        <ul>
                            <li>Se nell'anno di riferimento hai versato dei contributi, questi vengono detratti dal tuo reddito netto.</li>
                            <li>Se avevi versato gli acconti nell'anno precedente, questi vengono scalati dai saldi che devi versare quest'anno.</li>
                        </ul>
                        <h3>Esempio di calcolo:</h3>
                        <p>Per un incasso di ${data.redditoIncassato}€, il ${data.coefficienteRedditività}% corrisponde a ${data.redditoNetto}€. Su questo importo, dovrai pagare:</p>
                        <ul>
                            <li>Imposta sostitutiva: ${data.impostaSostitutiva}% su ${data.redditoNetto}€, che equivale a <span class="saldo">${data.imposta}€</span>.</li>
                            <li>Contributi INPS: Contributi fissi di ${data.totaleContributiFissi}€${data.contributiVariabili > 0 ? ` e contributi variabili di <span class="saldo">${data.contributiVariabili}€</span>` : ''}. Totale contributi: <span class="saldo">${data.contributi}€</span>.</li>
                        </ul>
                        <p>Quindi, a livello di saldo, pagherai ${data.imposta + data.contributi}€ (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi).</p>
                        <h3>Acconti:</h3>
                        <p>Oltre al saldo, dovrai versare anche gli acconti per l’anno successivo:</p>
                        <ul>
                            <li>Imposta sostitutiva: pagherai il 100% dell'importo del saldo come acconto, quindi ulteriori <span class="acconto">${data.accontoImposte}€</span>.</li>
                            ${data.accontoContributi > 0 ? `<li>Contributi INPS Variabili: pagherai l'80% dei contributi variabili come acconto, quindi <span class="acconto">${data.accontoContributi}€</span>.</li>` : '<li>Contributi INPS Variabili: Nessun acconto dovuto poiché non ci sono contributi variabili.</li>'}
                        </ul>
                        <h3>Totale complessivo:</h3>
                        <p>Saldo totale: ${data.imposta + data.contributi}€ (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi)</p>
                        <p>Acconti totali: ${data.accontoImposte + data.accontoContributi}€ (di cui ${data.accontoImposte}€ di imposta e ${data.accontoContributi}€ di contributi)</p>
                        <p><strong>Importo complessivo (saldo + acconti): ${data.imposta + data.contributi + data.accontoImposte + data.accontoContributi}€</strong></p>
                        <p>Questi importi sono indicativi e, in sede di dichiarazione dei redditi, verranno calcolati con precisione.</p>
                    </div>
                `;
            }
            return testo;
        }

        function generaDettagliPagamenti(data) {
            let dettagli = `
                <div class="result-content">
                    <h2>Dettagli dei Pagamenti per l'anno ${data.anno}</h2>
                    <p>Hai guadagnato un reddito lordo di <strong>${data.redditoIncassato}€</strong> nel ${data.anno}, che corrisponde a un reddito netto di <strong>${data.redditoNetto}€</strong> applicando il coefficiente di redditività del <strong>${data.coefficienteRedditività}%</strong>.</p>
                    <h3>Tasse da pagare:</h3>
                    <ul>
                        <li>Saldo Imposta Sostitutiva sul ${data.anno}: <span class="saldo">${data.imposta}€</span> da pagare entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                        <li>Acconto Imposta Sostitutiva per il ${parseInt(data.anno) + 1}: <span class="acconto">${data.accontoImposte}€</span> da pagare in due rate:
                            <ul>
                                <li>Prima rata: <span class="acconto">${Math.round(data.accontoImposte / 2)}€</span> entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                                <li>Seconda rata: <span class="acconto">${Math.round(data.accontoImposte / 2)}€</span> entro il 30 novembre ${parseInt(data.anno) + 1}.</li>
                            </ul>
                        </li>
                    </ul>
            `;

            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                dettagli += `
                    <h3>Contributi Previdenziali:</h3>
                    <ul>
                        <li>Saldo Contributi INPS sul ${data.anno}: <span class="saldo">${data.saldoContributi}€</span> da pagare entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                        <li>Acconto Contributi INPS per il ${parseInt(data.anno) + 1}: <span class="acconto">${data.accontoContributi}€</span> da pagare in due rate:
                            <ul>
                                <li>Prima rata: <span class="acconto">${Math.round(data.accontoContributi / 2)}€</span> entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                                <li>Seconda rata: <span class="acconto">${Math.round(data.accontoContributi / 2)}€</span> entro il 30 novembre ${parseInt(data.anno) + 1}.</li>
                            </ul>
                        </li>
                    </ul>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                dettagli += `
                    <h3>Contributi Previdenziali:</h3>
                    <ul>
                        <li>Contributi Fissi INPS sul ${data.anno} da pagare nelle seguenti scadenze:</li>
                        <ul>
                `;
                data.rateContributiFissi.forEach(rata => {
                    dettagli += `<li>${rata.data}: <span class="saldo">${rata.importo}€</span></li>`;
                });
                dettagli += `</ul>`;

                if (data.contributiVariabili > 0) {
                    dettagli += `
                        <li>Saldo Contributi Variabili INPS sul ${data.anno}: <span class="saldo">${data.contributiVariabili}€</span> da pagare entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                        <li>Acconto Contributi Variabili INPS per il ${parseInt(data.anno) + 1}: <span class="acconto">${data.accontoContributi}€</span> da pagare in due rate:
                            <ul>
                                <li>Prima rata: <span class="acconto">${Math.round(data.accontoContributi / 2)}€</span> entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                                <li>Seconda rata: <span class="acconto">${Math.round(data.accontoContributi / 2)}€</span> entro il 30 novembre ${parseInt(data.anno) + 1}.</li>
                            </ul>
                        </li>
                    `;
                } else {
                    dettagli += `
                        <li>Non sono dovuti contributi variabili INPS poiché non hai superato la soglia di reddito.</li>
                    `;
                }
                dettagli += `</ul>`;
            }

            const contributiFissiTotale = data.cassaPrevidenziale === 'gestioneSeparata' ? 0 : data.totaleContributiFissi;

            const totaleSaldo = data.saldoImposte + data.saldoContributi;
            const totaleAcconti = data.accontoImposte + data.accontoContributi;
            const totaleComplessivo = totaleSaldo + totaleAcconti + contributiFissiTotale;

            const percSaldo = (((totaleSaldo + contributiFissiTotale) / data.redditoIncassato) * 100).toFixed(0);
            const percAcconti = ((totaleAcconti / data.redditoIncassato) * 100).toFixed(0);
            const percTotale = ((totaleComplessivo / data.redditoIncassato) * 100).toFixed(0);

            dettagli += `
                    <h3>Riepilogo dei Pagamenti:</h3>
                    <p><strong>Totale tasse e contributi effettivi sul ${data.anno}:</strong> ${totaleSaldo + contributiFissiTotale}€ (circa il ${percSaldo}% del tuo reddito lordo)</p>
                    <p><strong>Totale acconti per il ${parseInt(data.anno) + 1}:</strong> ${totaleAcconti}€ (circa il ${percAcconti}% del tuo reddito lordo)</p>
                    <p><strong>Totale da versare complessivamente:</strong> ${totaleComplessivo}€ (circa il ${percTotale}% del tuo reddito lordo)</p>
                    <p><em>Nota:</em> Gli acconti sono un anticipo sulle tasse e contributi dell'anno successivo e non rappresentano un costo aggiuntivo.</p>
                </div>
            `;
            return dettagli;
        }

        function generaScadenzePagamenti(data) {
            let scadenze = `
                <div class="result-content">
                    <h2>Scadenze dei Pagamenti</h2>
            `;

            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                const totalePrimaRata = data.saldoImposte + Math.round(data.accontoImposte / 2) + data.saldoContributi + Math.round(data.accontoContributi / 2);
                const totaleSecondaRata = Math.round(data.accontoImposte / 2) + Math.round(data.accontoContributi / 2);

                scadenze += `
                    <table class="result-table">
                        <tr>
                            <th>Data Scadenza</th>
                            <th>Importo Totale</th>
                            <th>Dettaglio</th>
                        </tr>
                        <tr>
                            <td>30 giugno ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totalePrimaRata}€</strong></td>
                            <td>
                                Saldo Imposta Sostitutiva (<span class="saldo">${data.saldoImposte}€</span>), Prima rata Acconto Imposta (<span class="acconto">${Math.round(data.accontoImposte / 2)}€</span>), Saldo Contributi INPS (<span class="saldo">${data.saldoContributi}€</span>), Prima rata Acconto Contributi INPS (<span class="acconto">${Math.round(data.accontoContributi / 2)}€</span>)
                            </td>
                        </tr>
                        <tr>
                            <td>30 novembre ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totaleSecondaRata}€</strong></td>
                            <td>
                                Seconda rata Acconto Imposta (<span class="acconto">${Math.round(data.accontoImposte / 2)}€</span>), Seconda rata Acconto Contributi INPS (<span class="acconto">${Math.round(data.accontoContributi / 2)}€</span>)
                            </td>
                        </tr>
                    </table>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                scadenze += `
                    <h3>Contributi Fissi INPS:</h3>
                    <table class="result-table">
                        <tr>
                            <th>Data Scadenza</th>
                            <th>Importo</th>
                        </tr>
                `;

                data.rateContributiFissi.forEach(rata => {
                    scadenze += `<tr><td>${rata.data}</td><td><strong>${rata.importo}€</strong></td></tr>`;
                });

                scadenze += `</table>`;

                const totalePrimaRata = data.saldoImposte + Math.round(data.accontoImposte / 2) + data.contributiVariabili + Math.round(data.accontoContributi / 2);
                const totaleSecondaRata = Math.round(data.accontoImposte / 2) + Math.round(data.accontoContributi / 2);

                scadenze += `
                    <h3>Imposte e Contributi Variabili:</h3>
                    <table class="result-table">
                        <tr>
                            <th>Data Scadenza</th>
                            <th>Importo Totale</th>
                            <th>Dettaglio</th>
                        </tr>
                        <tr>
                            <td>30 giugno ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totalePrimaRata}€</strong></td>
                            <td>
                                Saldo Imposta Sostitutiva (<span class="saldo">${data.saldoImposte}€</span>), Prima rata Acconto Imposta (<span class="acconto">${Math.round(data.accontoImposte / 2)}€</span>) ${data.contributiVariabili > 0 ? `, Saldo Contributi Variabili INPS (<span class="saldo">${data.contributiVariabili}€</span>), Prima rata Acconto Contributi Variabili INPS (<span class="acconto">${Math.round(data.accontoContributi / 2)}€</span>)` : ''}
                            </td>
                        </tr>
                        <tr>
                            <td>30 novembre ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totaleSecondaRata}€</strong></td>
                            <td>
                                Seconda rata Acconto Imposta (<span class="acconto">${Math.round(data.accontoImposte / 2)}€</span>) ${data.contributiVariabili > 0 ? `, Seconda rata Acconto Contributi Variabili INPS (<span class="acconto">${Math.round(data.accontoContributi / 2)}€</span>)` : ''}
                            </td>
                        </tr>
                    </table>
                `;
            }

            scadenze += `</div>`;
            return scadenze;
        }

        function openTab(evt, tabName) {
            const tablinks = document.getElementsByClassName('tablink');
            const tabs = document.getElementsByClassName('tab');

            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
