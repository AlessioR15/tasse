<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Calcolatore Regime Forfettario</title>
    <style>
        /* CSS */
        body {
            background-color: #f4f4f4;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }

        .calculator-container {
            background-color: #fff;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .calculator-container h1 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group button {
            background-color: #007BFF;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .form-group button:hover {
            background-color: #0056b3;
        }

        #risultati {
            margin-top: 30px;
            text-align: left;
        }

        #risultati h2 {
            color: #333;
        }

        #risultati p {
            color: #555;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>Calcolatore Regime Forfettario</h1>
        <form id="calculator-form">
            <div class="form-group">
                <label for="annoRiferimento">Anno di riferimento:</label>
                <select id="annoRiferimento">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>
            <div class="form-group">
                <label for="redditoIncassato">Reddito incassato con partita IVA (€):</label>
                <input type="number" id="redditoIncassato" required>
            </div>
            <div class="form-group">
                <label for="impostaSostitutiva">Imposta sostitutiva:</label>
                <select id="impostaSostitutiva">
                    <option value="5">5%</option>
                    <option value="15">15%</option>
                </select>
            </div>
            <div class="form-group">
                <label for="coefficienteRedditività">Coefficiente di redditività del tuo codice Ateco:</label>
                <select id="coefficienteRedditività">
                    <option value="86">86%</option>
                    <option value="78">78%</option>
                    <option value="67">67%</option>
                    <option value="40">40%</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cassaPrevidenziale">Seleziona la cassa previdenziale a cui sei iscritto:</label>
                <select id="cassaPrevidenziale">
                    <option value="gestioneSeparata">Gestione Separata INPS</option>
                    <option value="inpsCommercianti">INPS Commercianti</option>
                    <option value="inpsArtigiani">INPS Artigiani</option>
                    <option value="enpap">Enpap</option>
                    <option value="enpapi">Enpapi</option>
                    <option value="inarcassa">Inarcassa</option>
                    <option value="enpam">Enpam</option>
                    <option value="cassaForense">Cassa Forense</option>
                </select>
            </div>
            <div class="form-group" id="riduzioneContainer" style="display: none;">
                <label for="riduzione35">Ho richiesto la riduzione del 35%:</label>
                <input type="checkbox" id="riduzione35">
            </div>
            <div class="form-group" id="dataAperturaContainer" style="display: none;">
                <label for="dataApertura">Data di apertura della Partita IVA:</label>
                <input type="date" id="dataApertura">
            </div>
            <div class="form-group">
                <button type="button" onclick="calcola()">Calcola</button>
            </div>
        </form>
        <div id="risultati"></div>
    </div>

    <script>
        // JavaScript
        // Dati per gli anni di riferimento
        const anniRiferimento = {
            "2024": {
                "gestioneSeparata": 26.07,
                "inpsCommercianti": {
                    "contributoFisso": 4515.43,
                    "aliquotaVariabile": 24.48,
                    "sogliaReddito": 18415
                },
                "inpsArtigiani": {
                    "contributoFisso": 4427.04,
                    "aliquotaVariabile": 24,
                    "sogliaReddito": 18415
                }
            },
            "2025": {
                // Aggiorna le percentuali per il 2025 se necessario
            }
        };

        // Mostra/nasconde campi in base alla cassa previdenziale selezionata
        document.getElementById('cassaPrevidenziale').addEventListener('change', function() {
            const cassa = this.value;
            const riduzioneContainer = document.getElementById('riduzioneContainer');
            const dataAperturaContainer = document.getElementById('dataAperturaContainer');
            if (cassa === 'inpsCommercianti' || cassa === 'inpsArtigiani') {
                riduzioneContainer.style.display = 'block';
                dataAperturaContainer.style.display = 'block';
            } else {
                riduzioneContainer.style.display = 'none';
                dataAperturaContainer.style.display = 'none';
            }
        });

        function calcola() {
            const anno = document.getElementById('annoRiferimento').value;
            const redditoIncassato = parseFloat(document.getElementById('redditoIncassato').value);
            const impostaSostitutiva = parseFloat(document.getElementById('impostaSostitutiva').value);
            const coefficienteRedditività = parseFloat(document.getElementById('coefficienteRedditività').value);
            const cassaPrevidenziale = document.getElementById('cassaPrevidenziale').value;
            const riduzione35 = document.getElementById('riduzione35').checked;
            const dataApertura = document.getElementById('dataApertura').value ? new Date(document.getElementById('dataApertura').value) : null;

            const redditoNetto = redditoIncassato * (coefficienteRedditività / 100);
            let contributi = 0;
            let imposta = (redditoNetto * impostaSostitutiva) / 100;

            if (cassaPrevidenziale === 'gestioneSeparata') {
                const aliquotaContributi = anniRiferimento[anno]["gestioneSeparata"];
                contributi = (redditoNetto * aliquotaContributi) / 100;
            } else if (cassaPrevidenziale === 'inpsCommercianti' || cassaPrevidenziale === 'inpsArtigiani') {
                const datiCassa = anniRiferimento[anno][cassaPrevidenziale];
                // Calcolo del contributo fisso
                let contributoFisso = datiCassa.contributoFisso;
                if (riduzione35) {
                    contributoFisso *= 0.65;
                }
                // Adegua il contributo fisso in base alla data di apertura
                if (dataApertura) {
                    contributoFisso = calcolaContributoFissoProporzionale(contributoFisso, dataApertura, anno);
                }
                // Calcolo del contributo variabile se supera la soglia
                let contributiVariabili = 0;
                if (redditoNetto > datiCassa.sogliaReddito) {
                    const eccedenza = redditoNetto - datiCassa.sogliaReddito;
                    contributiVariabili = (eccedenza * datiCassa.aliquotaVariabile) / 100;
                }
                contributi = contributoFisso + contributiVariabili;
            } else {
                // Placeholder per altre casse previdenziali
                contributi = 0;
            }

            // Calcolo di saldi e acconti
            const saldoImposte = imposta;
            const accontoImposte = imposta; // 100% del saldo
            const saldoContributi = contributi;
            const accontoContributi = contributi * 0.8; // 80% del saldo

            mostraRisultati({
                redditoNetto,
                imposta,
                contributi,
                saldoImposte,
                accontoImposte,
                saldoContributi,
                accontoContributi
            });
        }

        function calcolaContributoFissoProporzionale(contributoFisso, dataApertura, anno) {
            const date1 = new Date(`${anno}-05-16`);
            const date2 = new Date(`${anno}-08-20`);
            const date3 = new Date(`${anno}-11-16`);
            const date4 = new Date(`${parseInt(anno) +1}-02-16`);

            const trimestri = [
                { start: new Date(`${anno}-01-01`), end: new Date(`${anno}-03-31`), rata: 1 },
                { start: new Date(`${anno}-04-01`), end: new Date(`${anno}-06-30`), rata: 2 },
                { start: new Date(`${anno}-07-01`), end: new Date(`${anno}-09-30`), rata: 3 },
                { start: new Date(`${anno}-10-01`), end: new Date(`${anno}-12-31`), rata: 4 }
            ];

            let contributoTotale = 0;
            const contributoTrimestre = contributoFisso / 4;

            for (let i = 0; i < trimestri.length; i++) {
                const trimestre = trimestri[i];
                if (dataApertura <= trimestre.end) {
                    if (dataApertura > trimestre.start) {
                        // Calcola proporzionalmente il contributo per questo trimestre
                        const daysInQuarter = (trimestre.end - trimestre.start) / (1000 * 60 * 60 * 24) + 1;
                        const daysActive = (trimestre.end - dataApertura) / (1000 * 60 * 60 * 24) + 1;
                        const proporzione = daysActive / daysInQuarter;
                        contributoTotale += contributoTrimestre * proporzione;
                    } else {
                        // Paga l'intero contributo trimestrale
                        contributoTotale += contributoTrimestre;
                    }
                }
            }

            return contributoTotale;
        }

        function mostraRisultati(data) {
            const risultatiDiv = document.getElementById('risultati');
            risultatiDiv.innerHTML = `
                <h2>Risultati:</h2>
                <p><strong>Reddito Netto:</strong> €${data.redditoNetto.toFixed(2)}</p>
                <p><strong>Imposta da pagare:</strong> €${data.imposta.toFixed(2)}</p>
                <p><strong>Contributi da pagare:</strong> €${data.contributi.toFixed(2)}</p>
                <h3>Saldi e Acconti:</h3>
                <p><strong>Saldo Imposte:</strong> €${data.saldoImposte.toFixed(2)}</p>
                <p><strong>Acconto Imposte:</strong> €${data.accontoImposte.toFixed(2)}</p>
                <p><strong>Saldo Contributi:</strong> €${data.saldoContributi.toFixed(2)}</p>
                <p><strong>Acconto Contributi:</strong> €${data.accontoContributi.toFixed(2)}</p>
            `;
        }
    </script>
</body>
</html>
