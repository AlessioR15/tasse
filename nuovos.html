<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Calcolatore Regime Forfettario</title>
    <style>
        /* CSS */
        body {
            background-color: #f4f4f4;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }

        .calculator-container {
            background-color: #fff;
            max-width: 700px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .calculator-container h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group button {
            background-color: #007BFF;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .form-group button:hover {
            background-color: #0056b3;
        }

        #risultati {
            margin-top: 30px;
        }

        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tabs button {
            flex: 1;
            padding: 10px;
            border: none;
            background-color: #ddd;
            cursor: pointer;
        }

        .tabs button.active {
            background-color: #007BFF;
            color: #fff;
        }

        .result-content {
            color: #555;
            line-height: 1.6;
        }

        .result-content h2 {
            color: #333;
        }

        .result-content p {
            margin: 5px 0;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .result-table th,
        .result-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .result-table th {
            background-color: #f2f2f2;
        }

        /* Stili per evidenziare saldi e acconti */
        .saldo {
            color: #d9534f; /* Rosso per i saldi */
            font-weight: bold;
        }

        .acconto {
            color: #f0ad4e; /* Arancione per gli acconti */
            font-weight: bold;
        }

        .evidenziato {
            background-color: #ffffcc;
        }

        strong {
            font-weight: bold;
        }

        em {
            font-style: italic;
        }

        u {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>Calcolatore Regime Forfettario</h1>
        <form id="calculator-form">
            <div class="form-group">
                <label for="annoRiferimento">Anno di riferimento:</label>
                <select id="annoRiferimento">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>
            <div class="form-group">
                <label for="redditoIncassato">Reddito incassato con partita IVA (€):</label>
                <input type="number" id="redditoIncassato" required>
            </div>
            <div class="form-group">
                <label for="impostaSostitutiva">Imposta sostitutiva:</label>
                <select id="impostaSostitutiva">
                    <option value="5">5%</option>
                    <option value="15">15%</option>
                </select>
            </div>
            <div class="form-group">
                <label for="coefficienteRedditività">Coefficiente di redditività del tuo codice Ateco:</label>
                <select id="coefficienteRedditività">
                    <option value="86">86%</option>
                    <option value="78">78%</option>
                    <option value="67">67%</option>
                    <option value="40">40%</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cassaPrevidenziale">Seleziona la cassa previdenziale a cui sei iscritto:</label>
                <select id="cassaPrevidenziale">
                    <option value="gestioneSeparata">Gestione Separata INPS</option>
                    <option value="inpsCommercianti">INPS Commercianti</option>
                    <option value="inpsArtigiani">INPS Artigiani</option>
                    <!-- Altre casse previdenziali -->
                </select>
            </div>
            <div class="form-group" id="riduzioneContainer" style="display: none;">
                <label for="riduzione35">Ho richiesto la riduzione del 35%:</label>
                <input type="checkbox" id="riduzione35">
            </div>
            <div class="form-group" id="dataAperturaContainer" style="display: none;">
                <label for="dataApertura">Data di apertura della Partita IVA:</label>
                <input type="date" id="dataApertura">
            </div>
            <div class="form-group">
                <button type="button" onclick="calcola()">Calcola</button>
            </div>
        </form>
        <div id="risultati"></div>
    </div>

    <script>
        // JavaScript
        // Dati per gli anni di riferimento
        const anniRiferimento = {
            "2024": {
                "gestioneSeparata": 26,
                "inpsCommercianti": {
                    "contributoFisso": 4515,
                    "aliquotaVariabile": 24,
                    "sogliaReddito": 18415
                },
                "inpsArtigiani": {
                    "contributoFisso": 4427,
                    "aliquotaVariabile": 24,
                    "sogliaReddito": 18415
                }
            },
            "2025": {
                // Aggiorna le percentuali per il 2025 se necessario
            }
        };

        // Mostra/nasconde campi in base alla cassa previdenziale selezionata
        document.getElementById('cassaPrevidenziale').addEventListener('change', function() {
            const cassa = this.value;
            const riduzioneContainer = document.getElementById('riduzioneContainer');
            const dataAperturaContainer = document.getElementById('dataAperturaContainer');
            if (cassa === 'inpsCommercianti' || cassa === 'inpsArtigiani') {
                riduzioneContainer.style.display = 'block';
                dataAperturaContainer.style.display = 'block';
            } else {
                riduzioneContainer.style.display = 'none';
                dataAperturaContainer.style.display = 'none';
            }
        });

        function calcola() {
            const anno = document.getElementById('annoRiferimento').value;
            const redditoIncassato = parseInt(document.getElementById('redditoIncassato').value);
            const impostaSostitutiva = parseInt(document.getElementById('impostaSostitutiva').value);
            const coefficienteRedditività = parseInt(document.getElementById('coefficienteRedditività').value);
            const cassaPrevidenziale = document.getElementById('cassaPrevidenziale').value;
            const riduzione35 = document.getElementById('riduzione35').checked;
            const dataApertura = document.getElementById('dataApertura').value ? new Date(document.getElementById('dataApertura').value) : null;

            const redditoNetto = Math.round(redditoIncassato * (coefficienteRedditività / 100));
            let contributi = 0;
            let imposta = Math.round((redditoNetto * impostaSostitutiva) / 100);

            let contributiFissi = 0;
            let contributiVariabili = 0;
            let rateContributiFissi = [];
            let totaleContributiFissi = 0;

            if (cassaPrevidenziale === 'gestioneSeparata') {
                const aliquotaContributi = anniRiferimento[anno]["gestioneSeparata"];
                contributi = Math.round((redditoNetto * aliquotaContributi) / 100);
            } else if (cassaPrevidenziale === 'inpsCommercianti' || cassaPrevidenziale === 'inpsArtigiani') {
                const datiCassa = anniRiferimento[anno][cassaPrevidenziale];
                // Calcolo del contributo fisso
                contributiFissi = datiCassa.contributoFisso;
                if (riduzione35) {
                    contributiFissi = Math.round(contributiFissi * 0.65);
                }
                // Calcolo delle rate dei contributi fissi
                if (dataApertura) {
                    const risultato = calcolaContributoFissoProporzionale(contributiFissi, dataApertura, anno);
                    rateContributiFissi = risultato.rate;
                    totaleContributiFissi = risultato.totale;
                } else {
                    const rata = Math.round(contributiFissi / 4);
                    rateContributiFissi = [
                        { data: `16 maggio ${anno}`, importo: rata },
                        { data: `20 agosto ${anno}`, importo: rata },
                        { data: `16 novembre ${anno}`, importo: rata },
                        { data: `16 febbraio ${parseInt(anno) + 1}`, importo: rata }
                    ];
                    totaleContributiFissi = rata * 4;
                }
                // Calcolo del contributo variabile se supera la soglia
                if (redditoNetto > datiCassa.sogliaReddito) {
                    const eccedenza = redditoNetto - datiCassa.sogliaReddito;
                    contributiVariabili = Math.round((eccedenza * datiCassa.aliquotaVariabile) / 100);
                }
                contributi = totaleContributiFissi + contributiVariabili;
            } else {
                // Placeholder per altre casse previdenziali
                contributi = 0;
            }

            // Calcolo di saldi e acconti
            const saldoImposte = imposta;
            const accontoImposte = imposta; // 100% del saldo
            const saldoContributi = contributi;
            let accontoContributi = 0;
            if (cassaPrevidenziale === 'gestioneSeparata') {
                accontoContributi = Math.round(contributi * 0.8); // 80% del saldo
            } else if (cassaPrevidenziale === 'inpsCommercianti' || cassaPrevidenziale === 'inpsArtigiani') {
                accontoContributi = Math.round(contributiVariabili * 0.8); // Solo sui contributi variabili
            }

            mostraRisultati({
                anno,
                redditoIncassato,
                coefficienteRedditività,
                redditoNetto,
                impostaSostitutiva,
                imposta,
                contributiFissi,
                contributiVariabili,
                contributi,
                saldoImposte,
                accontoImposte,
                saldoContributi,
                accontoContributi,
                cassaPrevidenziale,
                rateContributiFissi,
                totaleContributiFissi
            });
        }

        function calcolaContributoFissoProporzionale(contributoFisso, dataApertura, anno) {
            const trimestri = [
                { start: new Date(`${anno}-01-01`), end: new Date(`${anno}-03-31`), rata: 1, scadenza: `16 maggio ${anno}` },
                { start: new Date(`${anno}-04-01`), end: new Date(`${anno}-06-30`), rata: 2, scadenza: `20 agosto ${anno}` },
                { start: new Date(`${anno}-07-01`), end: new Date(`${anno}-09-30`), rata: 3, scadenza: `16 novembre ${anno}` },
                { start: new Date(`${anno}-10-01`), end: new Date(`${anno}-12-31`), rata: 4, scadenza: `16 febbraio ${parseInt(anno) +1}` }
            ];

            let rate = [];
            const contributoTrimestre = Math.round(contributoFisso / 4);
            let totale = 0;

            for (let i = 0; i < trimestri.length; i++) {
                const trimestre = trimestri[i];
                if (dataApertura <= trimestre.end) {
                    if (dataApertura >= trimestre.start) {
                        // Calcola proporzionalmente il contributo per questo trimestre
                        const daysInQuarter = (trimestre.end - trimestre.start) / (1000 * 60 * 60 * 24) + 1;
                        const daysActive = (trimestre.end - dataApertura) / (1000 * 60 * 60 * 24) + 1;
                        const proporzione = daysActive / daysInQuarter;
                        const importo = Math.round(contributoTrimestre * proporzione);
                        rate.push({ data: trimestre.scadenza, importo });
                        totale += importo;
                    } else {
                        // Paga l'intero contributo trimestrale
                        rate.push({ data: trimestre.scadenza, importo: contributoTrimestre });
                        totale += contributoTrimestre;
                    }
                }
            }

            return { rate, totale };
        }

        function mostraRisultati(data) {
            const risultatiDiv = document.getElementById('risultati');
            risultatiDiv.innerHTML = `
                <div class="tabs">
                    <button class="tablink active" onclick="openTab(event, 'calcoli')">Come si calcolano</button>
                    <button class="tablink" onclick="openTab(event, 'dettagli')">Dettagli pagamenti</button>
                    <button class="tablink" onclick="openTab(event, 'scadenze')">Scadenze pagamenti</button>
                </div>
                <div id="calcoli" class="tab active">
                    ${generaTestoCalcoli(data)}
                </div>
                <div id="dettagli" class="tab">
                    ${generaDettagliPagamenti(data)}
                </div>
                <div id="scadenze" class="tab">
                    ${generaScadenzePagamenti(data)}
                </div>
            `;
        }

        function generaTestoCalcoli(data) {
            let testo = '';
            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                testo = `
                    <div class="result-content">
                        <h2>Dettaglio dei Calcoli</h2>
                        <p>In regime forfettario paghi l'imposta sostitutiva, che nel tuo caso è del <strong>${data.impostaSostitutiva}%</strong>.</p>
                        <p>Paghi inoltre i contributi alla <strong>Gestione Separata INPS</strong> con un'aliquota del <strong>${anniRiferimento[data.anno]["gestioneSeparata"]}%</strong>.</p>
                        <p>L'imposta e i contributi si calcolano sul <strong>${data.coefficienteRedditività}%</strong> del tuo incassato.</p>
                        <p><strong>${data.redditoIncassato}€</strong> x <strong>${data.coefficienteRedditività}%</strong> = <strong>${data.redditoNetto}€</strong> (reddito netto imponibile)</p>
                        <h3>Nota bene:</h3>
                        <ul>
                            <li>Se nell'anno di riferimento hai versato dei contributi, questi vengono detratti dal tuo reddito netto.</li>
                            <li>Se avevi versato gli acconti nell'anno precedente, questi vengono scalati dai saldi che devi versare quest'anno.</li>
                        </ul>
                        <h3>Esempio di calcolo:</h3>
                        <p>Per un incasso di <strong>${data.redditoIncassato}€</strong>, il <strong>${data.coefficienteRedditività}%</strong> corrisponde a <strong>${data.redditoNetto}€</strong>. Su questo importo, dovrai pagare:</p>
                        <ul>
                            <li class="saldo">Imposta sostitutiva: ${data.impostaSostitutiva}% su ${data.redditoNetto}€, che equivale a ${data.imposta}€.</li>
                            <li class="saldo">Contributi INPS: Aliquota del ${anniRiferimento[data.anno]["gestioneSeparata"]}% su ${data.redditoNetto}€, che equivale a ${data.contributi}€.</li>
                        </ul>
                        <p>Quindi, a livello di <strong>saldo</strong>, pagherai <strong>${data.imposta + data.contributi}€</strong> (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi).</p>
                        <h3>Acconti:</h3>
                        <p>Oltre al saldo, dovrai versare anche gli <strong class="acconto">acconti</strong> per l’anno successivo:</p>
                        <ul>
                            <li class="acconto">Imposta sostitutiva: pagherai il 100% dell'importo del saldo come acconto, quindi ulteriori ${data.accontoImposte}€.</li>
                            <li class="acconto">Contributi INPS: pagherai l'80% dell'importo del saldo come acconto, quindi ulteriori ${data.accontoContributi}€.</li>
                        </ul>
                        <h3>Totale complessivo:</h3>
                        <p><strong>Saldo totale:</strong> ${data.imposta + data.contributi}€ (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi)</p>
                        <p><strong>Acconti totali:</strong> ${data.accontoImposte + data.accontoContributi}€ (di cui ${data.accontoImposte}€ di imposta e ${data.accontoContributi}€ di contributi)</p>
                        <p><strong>Importo complessivo (saldo + acconti): ${data.imposta + data.contributi + data.accontoImposte + data.accontoContributi}€</strong></p>
                        <p>Questi importi sono indicativi e, in sede di dichiarazione dei redditi, verranno calcolati con precisione.</p>
                    </div>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                testo = `
                    <div class="result-content">
                        <h2>Dettaglio dei Calcoli</h2>
                        <p>In regime forfettario paghi l'imposta sostitutiva, che nel tuo caso è del <strong>${data.impostaSostitutiva}%</strong>.</p>
                        <p>Paghi inoltre i <strong>contributi fissi INPS ${data.cassaPrevidenziale === 'inpsCommercianti' ? 'Commercianti' : 'Artigiani'}</strong> di <strong>${data.totaleContributiFissi}€</strong> all'anno.</p>
                        <p>L'imposta e i contributi variabili si calcolano sul <strong>${data.coefficienteRedditività}%</strong> del tuo incassato.</p>
                        <p><strong>${data.redditoIncassato}€</strong> x <strong>${data.coefficienteRedditività}%</strong> = <strong>${data.redditoNetto}€</strong> (reddito netto imponibile)</p>
                        <h3>Nota bene:</h3>
                        <ul>
                            <li>Se nell'anno di riferimento hai versato dei contributi, questi vengono detratti dal tuo reddito netto.</li>
                            <li>Se avevi versato gli acconti nell'anno precedente, questi vengono scalati dai saldi che devi versare quest'anno.</li>
                        </ul>
                        <h3>Esempio di calcolo:</h3>
                        <p>Per un incasso di <strong>${data.redditoIncassato}€</strong>, il <strong>${data.coefficienteRedditività}%</strong> corrisponde a <strong>${data.redditoNetto}€</strong>. Su questo importo, dovrai pagare:</p>
                        <ul>
                            <li class="saldo">Imposta sostitutiva: ${data.impostaSostitutiva}% su ${data.redditoNetto}€, che equivale a ${data.imposta}€.</li>
                            <li class="saldo">Contributi INPS: Contributi fissi di ${data.totaleContributiFissi}€ ${data.contributiVariabili > 0 ? `+ Contributi variabili di ${data.contributiVariabili}€` : ''}. Totale contributi: ${data.contributi}€.</li>
                        </ul>
                        <p>Quindi, a livello di <strong>saldo</strong>, pagherai <strong>${data.imposta + data.contributi}€</strong> (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi).</p>
                        <h3>Acconti:</h3>
                        <p>Oltre al saldo, dovrai versare anche gli <strong class="acconto">acconti</strong> per l’anno successivo:</p>
                        <ul>
                            <li class="acconto">Imposta sostitutiva: pagherai il 100% dell'importo del saldo come acconto, quindi ulteriori ${data.accontoImposte}€.</li>
                            ${data.accontoContributi > 0 ? `<li class="acconto">Contributi INPS Variabili: pagherai l'80% dei contributi variabili come acconto, quindi ulteriori ${data.accontoContributi}€.</li>` : `<li>Contributi INPS Variabili: Nessun acconto dovuto poiché non ci sono contributi variabili.</li>`}
                        </ul>
                        <h3>Totale complessivo:</h3>
                        <p><strong>Saldo totale:</strong> ${data.imposta + data.contributi}€ (di cui ${data.imposta}€ di imposta e ${data.contributi}€ di contributi)</p>
                        <p><strong>Acconti totali:</strong> ${data.accontoImposte + data.accontoContributi}€ (di cui ${data.accontoImposte}€ di imposta e ${data.accontoContributi}€ di contributi)</p>
                        <p><strong>Importo complessivo (saldo + acconti): ${data.imposta + data.contributi + data.accontoImposte + data.accontoContributi}€</strong></p>
                        <p>Questi importi sono indicativi e, in sede di dichiarazione dei redditi, verranno calcolati con precisione.</p>
                    </div>
                `;
            }
            return testo;
        }

        function generaDettagliPagamenti(data) {
            let dettagli = `
                <div class="result-content">
                    <h2>Dettaglio dei pagamenti per l'anno ${data.anno}</h2>
                    <p>Hai guadagnato <strong>${data.redditoIncassato}€</strong> nel ${data.anno}.</p>
                    <h3>Calcolo del Reddito Netto:</h3>
                    <p>Reddito Lordo (<strong>${data.redditoIncassato}€</strong>) x Coefficiente di Redditività (<strong>${data.coefficienteRedditività}%</strong>) = <strong>${data.redditoNetto}€</strong></p>
                    <h3>Calcolo dell'Imposta Sostitutiva:</h3>
                    <p>Reddito Netto (<strong>${data.redditoNetto}€</strong>) x Aliquota Imposta Sostitutiva (<strong>${data.impostaSostitutiva}%</strong>) = <strong>${data.imposta}€</strong></p>
            `;

            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                dettagli += `
                    <h3>Calcolo dei Contributi INPS (Gestione Separata):</h3>
                    <p>Reddito Netto (<strong>${data.redditoNetto}€</strong>) x Aliquota Contributiva (<strong>${anniRiferimento[data.anno]["gestioneSeparata"]}%</strong>) = <strong>${data.contributi}€</strong></p>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                dettagli += `
                    <h3>Calcolo dei Contributi INPS (${data.cassaPrevidenziale === 'inpsCommercianti' ? 'Commercianti' : 'Artigiani'}):</h3>
                    <p>Contributi Fissi: <strong>${data.totaleContributiFissi}€</strong></p>
                    ${data.contributiVariabili > 0 ? `<p>Contributi Variabili: <strong>${data.contributiVariabili}€</strong></p>` : ''}
                    <p><strong>Totale Contributi INPS: ${data.contributi}€</strong></p>
                `;
            }

            dettagli += `
                    <h3>Tasse da pagare:</h3>
                    <ul>
                        <li class="saldo">Saldo imposta sostitutiva sul ${data.anno} (<strong>${data.imposta}€</strong>) da pagare entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                        <li class="acconto">Acconto imposta sostitutiva per il ${parseInt(data.anno) + 1} (<strong>${data.accontoImposte}€</strong>) da pagare in due rate:
                            <ul>
                                <li>Prima rata (<strong>${Math.round(data.accontoImposte / 2)}€</strong>) entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                                <li>Seconda rata (<strong>${Math.round(data.accontoImposte / 2)}€</strong>) entro il 30 novembre ${parseInt(data.anno) + 1}.</li>
                            </ul>
                        </li>
                    </ul>
            `;

            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                dettagli += `
                    <h3>Contributi previdenziali:</h3>
                    <ul>
                        <li class="saldo">Saldo contributi INPS sul ${data.anno} (<strong>${data.contributi}€</strong>) da pagare entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                        <li class="acconto">Acconto contributi INPS per il ${parseInt(data.anno) + 1} (<strong>${data.accontoContributi}€</strong>) da pagare in due rate:
                            <ul>
                                <li>Prima rata (<strong>${Math.round(data.accontoContributi / 2)}€</strong>) entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                                <li>Seconda rata (<strong>${Math.round(data.accontoContributi / 2)}€</strong>) entro il 30 novembre ${parseInt(data.anno) + 1}.</li>
                            </ul>
                        </li>
                    </ul>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                dettagli += `
                    <h3>Contributi previdenziali:</h3>
                    <ul>
                        <li>Contributi fissi INPS sul ${data.anno} (<strong>${data.totaleContributiFissi}€</strong>) da pagare in:
                            <ul>
                `;

                data.rateContributiFissi.forEach(rata => {
                    dettagli += `<li><strong>${rata.importo}€</strong> entro il ${rata.data}</li>`;
                });

                dettagli += `
                            </ul>
                        </li>
                `;

                if (data.contributiVariabili > 0) {
                    dettagli += `
                        <li class="saldo">Saldo contributi variabili INPS sul ${data.anno} (<strong>${data.contributiVariabili}€</strong>) da pagare entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                        <li class="acconto">Acconto contributi variabili per il ${parseInt(data.anno) + 1} (<strong>${data.accontoContributi}€</strong>) da pagare in due rate:
                            <ul>
                                <li>Prima rata (<strong>${Math.round(data.accontoContributi / 2)}€</strong>) entro il 30 giugno ${parseInt(data.anno) + 1}.</li>
                                <li>Seconda rata (<strong>${Math.round(data.accontoContributi / 2)}€</strong>) entro il 30 novembre ${parseInt(data.anno) + 1}.</li>
                            </ul>
                        </li>
                    `;
                } else {
                    dettagli += `
                        <li>Contributi variabili INPS: Nessun contributo variabile dovuto poiché non hai superato la soglia di reddito.</li>
                    `;
                }

                dettagli += `</ul>`;
            }

            const totaleSaldo = data.saldoImposte + data.contributiVariabili;
            const totaleAcconti = data.accontoImposte + data.accontoContributi;
            const totaleComplessivo = totaleSaldo + totaleAcconti + data.totaleContributiFissi;

            // Calcolo delle percentuali relative al reddito lordo
            const percSaldo = ((totaleSaldo + data.totaleContributiFissi) / data.redditoIncassato * 100).toFixed(0);
            const percAcconti = (totaleAcconti / data.redditoIncassato * 100).toFixed(0);
            const percTotale = (totaleComplessivo / data.redditoIncassato * 100).toFixed(0);

            dettagli += `
                    <h3>Riepilogo dei Pagamenti:</h3>
                    <p><strong>Totale tasse e contributi effettivi sul ${data.anno}:</strong> ${totaleSaldo + data.totaleContributiFissi}€ (circa il ${percSaldo}% del tuo reddito lordo)</p>
                    <p><strong>Totale acconti per il ${parseInt(data.anno) + 1}:</strong> ${totaleAcconti}€ (circa il ${percAcconti}% del tuo reddito lordo)</p>
                    <p><strong>Totale da versare complessivamente:</strong> ${totaleComplessivo}€ (circa il ${percTotale}% del tuo reddito lordo)</p>
                    <p><em>Nota:</em> Gli acconti sono un anticipo sulle tasse e contributi dell'anno successivo (${parseInt(data.anno) + 1}) e non rappresentano un costo aggiuntivo.</p>
                </div>
            `;

            return dettagli;
        }

        function generaScadenzePagamenti(data) {
            let scadenze = `
                <div class="result-content">
                    <h2>Scadenze dei Pagamenti</h2>
            `;

            if (data.cassaPrevidenziale === 'gestioneSeparata') {
                const totalePrimaRata = data.saldoImposte + Math.round(data.accontoImposte / 2) + data.saldoContributi + Math.round(data.accontoContributi / 2);
                const totaleSecondaRata = Math.round(data.accontoImposte / 2) + Math.round(data.accontoContributi / 2);

                scadenze += `
                    <table class="result-table">
                        <tr>
                            <th>Data Scadenza</th>
                            <th>Importo Totale</th>
                            <th>Dettaglio</th>
                        </tr>
                        <tr>
                            <td>30 giugno ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totalePrimaRata}€</strong></td>
                            <td>
                                <span class="saldo">Saldo imposta sostitutiva (${data.saldoImposte}€)</span> + <span class="acconto">Prima rata acconto imposta (${Math.round(data.accontoImposte / 2)}€)</span> + <span class="saldo">Saldo contributi INPS (${data.saldoContributi}€)</span> + <span class="acconto">Prima rata acconto contributi INPS (${Math.round(data.accontoContributi / 2)}€)</span>
                            </td>
                        </tr>
                        <tr>
                            <td>30 novembre ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totaleSecondaRata}€</strong></td>
                            <td>
                                <span class="acconto">Seconda rata acconto imposta (${Math.round(data.accontoImposte / 2)}€)</span> + <span class="acconto">Seconda rata acconto contributi INPS (${Math.round(data.accontoContributi / 2)}€)</span>
                            </td>
                        </tr>
                    </table>
                `;
            } else if (data.cassaPrevidenziale === 'inpsCommercianti' || data.cassaPrevidenziale === 'inpsArtigiani') {
                scadenze += `
                    <h3>Contributi Fissi INPS:</h3>
                    <table class="result-table">
                        <tr>
                            <th>Data Scadenza</th>
                            <th>Importo</th>
                        </tr>
                `;

                data.rateContributiFissi.forEach(rata => {
                    scadenze += `<tr><td>${rata.data}</td><td><strong>${rata.importo}€</strong></td></tr>`;
                });

                scadenze += `</table>`;

                const totalePrimaRata = data.saldoImposte + Math.round(data.accontoImposte / 2) + data.contributiVariabili + Math.round(data.accontoContributi / 2);
                const totaleSecondaRata = Math.round(data.accontoImposte / 2) + Math.round(data.accontoContributi / 2);

                scadenze += `
                    <h3>Imposte e Contributi Variabili:</h3>
                    <table class="result-table">
                        <tr>
                            <th>Data Scadenza</th>
                            <th>Importo Totale</th>
                            <th>Dettaglio</th>
                        </tr>
                        <tr>
                            <td>30 giugno ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totalePrimaRata}€</strong></td>
                            <td>
                                <span class="saldo">Saldo imposta sostitutiva (${data.saldoImposte}€)</span> + <span class="acconto">Prima rata acconto imposta (${Math.round(data.accontoImposte / 2)}€)</span> ${data.contributiVariabili > 0 ? `+ <span class="saldo">Saldo contributi INPS variabili (${data.contributiVariabili}€)</span> + <span class="acconto">Prima rata acconto contributi INPS variabili (${Math.round(data.accontoContributi / 2)}€)</span>` : ''}
                            </td>
                        </tr>
                        <tr>
                            <td>30 novembre ${parseInt(data.anno) + 1}</td>
                            <td><strong>${totaleSecondaRata}€</strong></td>
                            <td>
                                <span class="acconto">Seconda rata acconto imposta (${Math.round(data.accontoImposte / 2)}€)</span> ${data.contributiVariabili > 0 ? `+ <span class="acconto">Seconda rata acconto contributi INPS variabili (${Math.round(data.accontoContributi / 2)}€)</span>` : ''}
                            </td>
                        </tr>
                    </table>
                `;
            }

            scadenze += `</div>`;
            return scadenze;
        }

        function openTab(evt, tabName) {
            const tablinks = document.getElementsByClassName('tablink');
            const tabs = document.getElementsByClassName('tab');

            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
