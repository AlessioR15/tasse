<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Calcolatore Regime Forfettario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* CSS per il calcolatore */

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 800px;
    margin: auto;
    padding: 20px;
}

h1 {
    text-align: center;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
}

input[type="number"],
input[type="date"],
select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}

#calcola-btn {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 16px;
}

#calcola-btn:hover {
    background-color: #0056b3;
}

#risultati {
    margin-top: 20px;
}

#risultati table {
    width: 100%;
    border-collapse: collapse;
}

#risultati th,
#risultati td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

#risultati th {
    background-color: #f2f2f2;
}

.highlight-yellow {
    background-color: #fff9c4;
}

.highlight-blue {
    background-color: #bbdefb;
}

.highlight-yellow-text {
    background-color: #fff9c4;
    padding: 2px 5px;
    border-radius: 3px;
}

.highlight-blue-text {
    background-color: #bbdefb;
    padding: 2px 5px;
    border-radius: 3px;
}

.tabs {
    list-style-type: none;
    padding: 0;
    display: flex;
    cursor: pointer;
    margin-top: 20px;
}

.tab-link {
    padding: 10px 20px;
    background-color: #f2f2f2;
    margin-right: 5px;
    border-radius: 5px 5px 0 0;
}

.tab-link.current {
    background-color: #fff;
    border-bottom: 2px solid #007bff;
}

.tab-content {
    display: none;
    margin-top: 20px;
    padding: 20px;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 5px 5px 5px;
}

.tab-content.current {
    display: block;
}

@media screen and (max-width: 600px) {
    .tabs {
        flex-direction: column;
    }

    .tab-link {
        margin-bottom: 5px;
    }
}

    </style>
</head>
<body>
    <div class="container">
        <h1>Calcolatore Regime Forfettario</h1>
        <form id="calculator-form">
            <div class="form-group">
                <label for="anno-riferimento">Anno di Riferimento:</label>
                <select id="anno-riferimento">
                    <option value="2024" selected>2024</option>
                    <option value="2025">2025</option>
                    <!-- Puoi aggiungere altri anni in futuro -->
                </select>
            </div>

            <div class="form-group">
                <label for="reddito-lordo">Reddito Lordo (€):</label>
                <input type="number" id="reddito-lordo" required>
            </div>

            <div class="form-group">
                <label for="aliquota-imposta">Aliquota dell'Imposta Sostitutiva:</label>
                <select id="aliquota-imposta">
                    <option value="5">5%</option>
                    <option value="15">15%</option>
                </select>
            </div>

            <div class="form-group">
                <label for="coefficiente-redditivita">Coefficiente di Redditività:</label>
                <select id="coefficiente-redditivita">
                    <option value="86">86%</option>
                    <option value="78">78%</option>
                    <option value="67">67%</option>
                    <option value="40">40%</option>
                    <!-- Aggiungi altri coefficienti se necessario -->
                </select>
            </div>

            <div class="form-group">
                <label for="cassa-inps">Cassa di Riferimento INPS:</label>
                <select id="cassa-inps">
                    <option value="gestione-separata">Gestione Separata INPS</option>
                    <option value="commercianti">INPS Commercianti</option>
                    <option value="artigiani">INPS Artigiani</option>
                </select>
            </div>

            <div class="form-group" id="data-apertura-group" style="display: none;">
                <label for="data-apertura">Data di Apertura della Partita IVA:</label>
                <input type="date" id="data-apertura">
            </div>

            <div class="form-group" id="riduzione-35-group" style="display: none;">
                <input type="checkbox" id="riduzione-35">
                <label for="riduzione-35">Applica riduzione del 35% sui contributi fissi INPS</label>
            </div>

            <button type="button" id="calcola-btn">Calcola</button>
        </form>

        <div id="risultati" style="display: none;">
            <!-- I risultati verranno mostrati qui -->
        </div>

        <div id="menu-schede" style="display: none;">
            <ul class="tabs">
                <li class="tab-link current" data-tab="tab-1">Come si Calcolano?</li>
                <li class="tab-link" data-tab="tab-2">Scadenza Pagamenti</li>
                <li class="tab-link" data-tab="tab-3">Dettaglio Pagamenti</li>
            </ul>

            <div id="tab-1" class="tab-content current">
                <!-- Spiegazione dettagliata dei calcoli -->
            </div>
            <div id="tab-2" class="tab-content">
                <!-- Dettaglio delle scadenze con tabelle -->
            </div>
            <div id="tab-3" class="tab-content">
                <!-- Riepilogo dettagliato dei pagamenti -->
            </div>
        </div>
    </div>

    <script>
        // JavaScript per il calcolatore

document.addEventListener('DOMContentLoaded', function() {
    const cassaInpsSelect = document.getElementById('cassa-inps');
    const riduzione35Group = document.getElementById('riduzione-35-group');
    const dataAperturaGroup = document.getElementById('data-apertura-group');
    const calcolaBtn = document.getElementById('calcola-btn');
    const risultatiDiv = document.getElementById('risultati');
    const menuSchede = document.getElementById('menu-schede');
    const annoRiferimentoSelect = document.getElementById('anno-riferimento');

    cassaInpsSelect.addEventListener('change', function() {
        if (this.value === 'commercianti' || this.value === 'artigiani') {
            riduzione35Group.style.display = 'block';
            dataAperturaGroup.style.display = 'block';
        } else {
            riduzione35Group.style.display = 'none';
            dataAperturaGroup.style.display = 'none';
        }
    });

    calcolaBtn.addEventListener('click', function() {
        calcola();
    });

    function calcola() {
        // Ottenere i valori di input
        const annoRiferimento = parseInt(document.getElementById('anno-riferimento').value) || 2024;
        const redditoLordo = parseInt(document.getElementById('reddito-lordo').value) || 0;
        const aliquotaImposta = parseInt(document.getElementById('aliquota-imposta').value) || 0;
        const coefficienteRedditivita = parseInt(document.getElementById('coefficiente-redditivita').value) || 0;
        const cassaInps = document.getElementById('cassa-inps').value;
        const riduzione35 = document.getElementById('riduzione-35').checked;
        const dataAperturaInput = document.getElementById('data-apertura').value;

        let mesiAttivi = 12; // Default per Gestione Separata
        let dataApertura = null;

        if ((cassaInps === 'commercianti' || cassaInps === 'artigiani') && dataAperturaInput) {
            dataApertura = new Date(dataAperturaInput);
            const annoApertura = dataApertura.getFullYear();
            const meseApertura = dataApertura.getMonth(); // 0-indexed
            mesiAttivi = (12 - meseApertura);
        }

        // Calcolo del reddito netto
        const redditoNetto = Math.round(redditoLordo * (coefficienteRedditivita / 100));

        // Calcolo dell'imposta sostitutiva
        const impostaSostitutiva = Math.round(redditoNetto * (aliquotaImposta / 100));

        // Calcolo dei contributi INPS
        let contributiInps = 0;
        let contributiFissi = 0;
        let contributiVariabili = 0;
        let aliquotaContributiva = 0;
        const sogliaReddito = 18415;

        if (cassaInps === 'gestione-separata') {
            aliquotaContributiva = 26.07; // Aggiornata al 2023
            contributiInps = Math.round(redditoNetto * (aliquotaContributiva / 100));
        } else if (cassaInps === 'commercianti' || cassaInps === 'artigiani') {
            let aliquotaVariabile = cassaInps === 'commercianti' ? 24.48 : 24;
            let contributiFissiAnnui = cassaInps === 'commercianti' ? 4515.43 : 4427.04;

            // Riduzione del 35% solo sui contributi fissi
            if (riduzione35) {
                contributiFissiAnnui = contributiFissiAnnui * 0.65;
            }

            // Calcolo contributi fissi proporzionati
            contributiFissi = Math.round((contributiFissiAnnui / 12) * mesiAttivi);

            // Calcolo contributi variabili
            if (redditoNetto > sogliaReddito) {
                const eccedenza = redditoNetto - sogliaReddito;
                contributiVariabili = Math.round(eccedenza * (aliquotaVariabile / 100));
            }

            contributiInps = contributiFissi + contributiVariabili;
            aliquotaContributiva = aliquotaVariabile;
        }

        // Calcolo degli acconti
        const accontoImposta = Math.round(impostaSostitutiva); // 100%
        let accontoInps = 0;

        if (cassaInps === 'gestione-separata') {
            accontoInps = Math.round(contributiInps * 0.80); // 80%
        } else if (cassaInps === 'commercianti' || cassaInps === 'artigiani') {
            accontoInps = contributiVariabili > 0 ? Math.round(contributiVariabili * 0.80) : 0; // Solo variabili
        }

        // Formattazione degli importi con separatori delle migliaia
        function formatEuro(value) {
            return value.toLocaleString('it-IT') + '€';
        }

        // Mostrare i risultati
        risultatiDiv.style.display = 'block';
        menuSchede.style.display = 'block';

        risultatiDiv.innerHTML = `
            <h2>Risultati</h2>
            <table>
                <tr>
                    <th>Descrizione</th>
                    <th>Importo</th>
                </tr>
                <tr>
                    <td>Reddito Lordo</td>
                    <td>${formatEuro(redditoLordo)}</td>
                </tr>
                <tr>
                    <td>Reddito Netto (anno ${annoRiferimento})</td>
                    <td>${formatEuro(redditoNetto)}</td>
                </tr>
                <tr>
                    <td>Imposta Sostitutiva (${aliquotaImposta}%) sul ${annoRiferimento}</td>
                    <td>${formatEuro(impostaSostitutiva)}</td>
                </tr>
                <tr>
                    <td>Acconto Imposta Sostitutiva (100%) sul ${annoRiferimento + 1}</td>
                    <td>${formatEuro(accontoImposta)}</td>
                </tr>
                <tr>
                    <td>Contributi INPS sul ${annoRiferimento}</td>
                    <td>${formatEuro(contributiInps)}</td>
                </tr>
                <tr>
                    <td>Acconto Contributi INPS sul ${annoRiferimento + 1} (calcolato con metodo storico)</td>
                    <td>${formatEuro(accontoInps)}</td>
                </tr>
            </table>
        `;

        // Popolare le schede
        popolaSchede({
            annoRiferimento,
            redditoLordo,
            redditoNetto,
            impostaSostitutiva,
            contributiInps,
            accontoImposta,
            accontoInps,
            contributiFissi,
            contributiVariabili,
            mesiAttivi,
            dataApertura,
            cassaInps,
            riduzione35,
            aliquotaImposta,
            coefficienteRedditivita,
            aliquotaContributiva,
            sogliaReddito
        });
    }

    function popolaSchede(dati) {
        // Funzione per evidenziare il testo
        function highlight(text, className) {
            return `<span class="${className}">${text}</span>`;
        }

        // Scheda "Come si Calcolano?"
        const tab1 = document.getElementById('tab-1');
        tab1.innerHTML = `
            <p>In regime forfettario paghi l'imposta sostitutiva, che nel tuo caso è del <strong>${dati.aliquotaImposta}%</strong>.</p>
            <p>L'imposta come i contributi li paghi non sul totale incassato ma sul <strong>${dati.coefficienteRedditivita}%</strong> (che è il coefficiente di redditività del tuo codice ATECO).</p>
            <p>Quindi paghi il <strong>${dati.aliquotaImposta}%</strong> di imposta e il <strong>${dati.aliquotaContributiva}%</strong> di contributi INPS non sul totale incassato (<strong>${formatEuro(dati.redditoLordo)}</strong>) ma sul tuo incassato per il coefficiente di redditività.</p>
            <p><strong>${formatEuro(dati.redditoLordo)} x ${dati.coefficienteRedditivita}% = ${formatEuro(dati.redditoNetto)} (reddito netto imponibile)</strong></p>
            <p>Nota bene:</p>
            <ul>
                <li>Se nell'anno di riferimento hai versato dei contributi, questi vengono detratti dal tuo reddito netto.</li>
                <li>Se avevi versato gli acconti nell'anno precedente, questi vengono scalati dai saldi che devi versare quest'anno.</li>
            </ul>
            <h3>Esempio di calcolo:</h3>
            <p>Per un incasso di <strong>${formatEuro(dati.redditoLordo)}</strong>, il <strong>${dati.coefficienteRedditivita}%</strong> corrisponde a <strong>${formatEuro(dati.redditoNetto)}</strong>. Su questo importo, dovrai pagare:</p>
            <ul>
                <li>Imposta sostitutiva: <strong>${dati.aliquotaImposta}%</strong> su <strong>${formatEuro(dati.redditoNetto)}</strong>, che equivale a <strong>${formatEuro(dati.impostaSostitutiva)}</strong>.</li>
                <li>Contributi INPS: <strong>${dati.aliquotaContributiva}%</strong> su <strong>${formatEuro(dati.redditoNetto)}</strong>, che equivale a <strong>${formatEuro(dati.contributiInps)}</strong>.</li>
            </ul>
            <p>Quindi, a livello di saldo, pagherai ${highlight(formatEuro(dati.impostaSostitutiva + dati.contributiInps), 'highlight-yellow-text')} (di cui <strong>${formatEuro(dati.impostaSostitutiva)}</strong> di imposta e <strong>${formatEuro(dati.contributiInps)}</strong> di contributi).</p>
            <h3>Acconti:</h3>
            <p>Oltre al saldo, dovrai versare anche gli acconti per l’anno successivo:</p>
            <ul>
                <li>Imposta sostitutiva: pagherai il <strong>100%</strong> dell'importo del saldo come acconto, quindi ulteriori ${highlight(formatEuro(dati.accontoImposta), 'highlight-blue-text')}.</li>
                <li>Contributi INPS: pagherai l'<strong>80%</strong> dei contributi INPS sul saldo come acconto, quindi ${highlight(formatEuro(dati.accontoInps), 'highlight-blue-text')}.</li>
            </ul>
            <h3>Totale complessivo:</h3>
            <ul>
                <li>Saldo totale: ${highlight(formatEuro(dati.impostaSostitutiva + dati.contributiInps), 'highlight-yellow-text')} (di cui <strong>${formatEuro(dati.impostaSostitutiva)}</strong> di imposta e <strong>${formatEuro(dati.contributiInps)}</strong> di contributi)</li>
                <li>Acconti totali: ${highlight(formatEuro(dati.accontoImposta + dati.accontoInps), 'highlight-blue-text')} (di cui <strong>${formatEuro(dati.accontoImposta)}</strong> di imposta e <strong>${formatEuro(dati.accontoInps)}</strong> di contributi)</li>
                <li>Importo complessivo (saldo + acconti): ${highlight(formatEuro(dati.impostaSostitutiva + dati.contributiInps + dati.accontoImposta + dati.accontoInps), 'highlight-yellow-text')}</li>
            </ul>
            <p>Questi importi sono indicativi e, in sede di dichiarazione dei redditi, verranno calcolati con precisione.</p>
        `;

        // Scheda "Scadenza Pagamenti"
        const tab2 = document.getElementById('tab-2');
        tab2.innerHTML = `
            <h3>Dettaglio dei Pagamenti</h3>
            <p><strong>Dettaglio dei pagamenti per l'anno ${dati.annoRiferimento}</strong></p>
            <p>Hai guadagnato ${formatEuro(dati.redditoLordo)} nel ${dati.annoRiferimento}.</p>
            <h4>Calcolo del Reddito Netto:</h4>
            <p>Reddito Lordo (${formatEuro(dati.redditoLordo)}) x Coefficiente di Redditività (${dati.coefficienteRedditivita}%) = ${formatEuro(dati.redditoNetto)}€</p>
            <h4>Calcolo dell'Imposta Sostitutiva:</h4>
            <p>Reddito Netto (${formatEuro(dati.redditoNetto)}) x Aliquota Imposta Sostitutiva (${dati.aliquotaImposta}%) = ${formatEuro(dati.impostaSostitutiva)}€</p>
            <h4>Calcolo dei Contributi INPS (${getCassaInpsNome(dati.cassaInps)}):</h4>
            ${getDettaglioContributi(dati)}
            <h3>Tasse da pagare:</h3>
            <ul>
                <li>${highlight('Saldo imposta sostitutiva sul ' + dati.annoRiferimento + ' (' + formatEuro(dati.impostaSostitutiva) + ')', 'highlight-yellow-text')} da pagare entro il 30 giugno ${dati.annoRiferimento + 1}.</li>
                <li>${highlight('Acconto imposta sostitutiva per il ' + (dati.annoRiferimento + 1) + ' (' + formatEuro(dati.accontoImposta) + ')', 'highlight-blue-text')} da pagare in due rate:
                    <ul>
                        <li>Prima rata (${formatEuro(Math.round(dati.accontoImposta / 2))}) entro il 30 giugno ${dati.annoRiferimento + 1}.</li>
                        <li>Seconda rata (${formatEuro(Math.round(dati.accontoImposta / 2))}) entro il 30 novembre ${dati.annoRiferimento + 1}.</li>
                    </ul>
                </li>
            </ul>
            ${getDettaglioContributiFissi(dati)}
            <p>${highlight('Nota: Gli acconti sono un anticipo sulle tasse e contributi dell\'anno successivo (' + (dati.annoRiferimento + 1) + ') e non rappresentano un costo aggiuntivo.', 'highlight-blue-text')}</p>
        `;

        // Scheda "Dettaglio Pagamenti"
        const tab3 = document.getElementById('tab-3');
        const totaleTasseContributi = dati.impostaSostitutiva + dati.contributiInps;
        const totaleAcconti = dati.accontoImposta + dati.accontoInps;
        const totaleDaVersare = totaleTasseContributi + totaleAcconti;
        const percentualeTasse = Math.round((totaleTasseContributi / dati.redditoLordo) * 100);
        const percentualeAcconti = Math.round((totaleAcconti / dati.redditoLordo) * 100);
        const percentualeTotale = Math.round((totaleDaVersare / dati.redditoLordo) * 100);

        tab3.innerHTML = `
            <h3>Riepilogo dei Pagamenti:</h3>
            <ul>
                <li><strong>Totale tasse e contributi effettivi sul ${dati.annoRiferimento}:</strong> ${formatEuro(totaleTasseContributi)} (circa il ${percentualeTasse}% del tuo reddito lordo)</li>
                <li><strong>Totale acconti per il ${dati.annoRiferimento + 1}:</strong> ${formatEuro(totaleAcconti)} (circa il ${percentualeAcconti}% del tuo reddito lordo)</li>
                <li><strong>Totale da versare complessivamente:</strong> ${formatEuro(totaleDaVersare)} (circa il ${percentualeTotale}% del tuo reddito lordo)</li>
            </ul>
            <p>Nota: Gli acconti sono un anticipo sulle tasse e contributi dell'anno successivo (${dati.annoRiferimento + 1}) e non rappresentano un costo aggiuntivo.</p>
        `;
    }

    function getContributiText(dati) {
        if (dati.cassaInps === 'gestione-separata') {
            return `${dati.aliquotaContributiva}% su ${formatEuro(dati.redditoNetto)}, che equivale a ${formatEuro(dati.contributiInps)}€.`;
        } else {
            let testo = `Contributi fissi: ${formatEuro(dati.contributiFissi)}€.`;
            if (dati.contributiVariabili > 0) {
                testo += ` Contributi variabili: ${formatEuro(dati.contributiVariabili)}€ (calcolati sul reddito eccedente ${formatEuro(dati.sogliaReddito)}).`;
            }
            return testo;
        }
    }

    function getPercentualeAcconto(dati) {
        if (dati.cassaInps === 'gestione-separata') {
            return '80';
        } else {
            return '0';
        }
    }

    function getAccontoBaseText(dati) {
        if (dati.cassaInps === 'gestione-separata') {
            return 'dell\'importo del saldo';
        } else {
            return 'dei contributi variabili';
        }
    }

    function getCassaInpsNome(cassa) {
        if (cassa === 'commercianti') {
            return 'INPS Commercianti';
        } else if (cassa === 'artigiani') {
            return 'INPS Artigiani';
        } else {
            return 'Gestione Separata INPS';
        }
    }

    function getDettaglioContributi(dati) {
        if (dati.cassaInps === 'gestione-separata') {
            return `<p>Contributi INPS: ${dati.aliquotaContributiva}% su ${formatEuro(dati.redditoNetto)}, che equivale a ${formatEuro(dati.contributiInps)}€.</p>`;
        } else {
            let testo = `<p>Contributi Fissi (stabiliti da INPS): ${formatEuro(dati.contributiFissi)}€</p>`;
            if (dati.contributiVariabili > 0) {
                testo += `<p>Contributi Variabili: ${formatEuro(dati.contributiVariabili)}€ (calcolati sul reddito eccedente ${formatEuro(dati.sogliaReddito)}€)</p>`;
            }
            testo += `<p>Totale Contributi INPS = ${formatEuro(dati.contributiInps)}€</p>`;
            return testo;
        }
    }

    function getDettaglioContributiFissi(dati) {
        if (dati.cassaInps === 'commercianti' || dati.cassaInps === 'artigiani') {
            const rata = Math.round(dati.contributiFissi / 4);
            return `
            <h3>Contributi previdenziali:</h3>
            <p>Contributi fissi INPS sul ${dati.annoRiferimento} (${formatEuro(dati.contributiFissi)}€) da pagare in quattro rate:</p>
            <ul>
                <li>Rata 1 (${formatEuro(rata)}€) entro il 16 maggio ${dati.annoRiferimento}.</li>
                <li>Rata 2 (${formatEuro(rata)}€) entro il 20 agosto ${dati.annoRiferimento}.</li>
                <li>Rata 3 (${formatEuro(rata)}€) entro il 16 novembre ${dati.annoRiferimento}.</li>
                <li>Rata 4 (${formatEuro(rata)}€) entro il 16 febbraio ${dati.annoRiferimento + 1}.</li>
            </ul>
            `;
        } else {
            return '';
        }
    }

    // Gestione delle schede
    const tabs = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(function(tab) {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');

            tabs.forEach(function(node) {
                node.classList.remove('current');
            });

            tabContents.forEach(function(node) {
                node.classList.remove('current');
            });

            this.classList.add('current');
            document.getElementById(tabId).classList.add('current');
        });
    });

    // Formattazione Euro per uso nella scheda
    function formatEuro(value) {
        return value.toLocaleString('it-IT') + '€';
    }
});

    </script>
</body>
</html>
